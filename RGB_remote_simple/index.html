<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGB Remote Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.inline {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .form-group.inline label {
            flex-shrink: 0;
            margin-bottom: 0;
        }
        
        .form-group.inline input {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #007bff;
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.connecting {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-text {
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            color: #495057;
            min-height: 20px;
        }
    </style>
</head>
<body>
    <div class="container">

        
        <!-- Connection Section -->
        <div class="section">
            <h2>Connect to Robot</h2>
            <div class="form-group">
                <input type="text" id="ipAddress" placeholder="IP Address" inputmode="decimal">
            </div>
            <div class="form-group">
                <input type="text" id="deviceId" placeholder="Device ID" inputmode="numeric">
            </div>
            <button id="connectBtn" onclick="connect()">Connect</button>
        </div>
        
        <!-- Status Display -->
        <div id="status" class="status disconnected" style="display: none;">
            Disconnected
        </div>
        
        <!-- Command Section -->
        <div class="section" id="commandSection">
            <h2>Select Command</h2>
            <div class="form-group">
                <label for="commandType">Command Type:</label>
                <select id="commandType" onchange="updateCommandForm()">
                    <option value="drive">Drive</option>
                    <option value="turn">Turn</option>
                    <option value="set_heading">Set Heading</option>
                </select>
            </div>
            
            <div id="commandParams">
                <!-- Command parameters will be inserted here -->
            </div>
            
            <button id="sendBtn" onclick="sendCommand()" disabled>Send Command</button>
        </div>
        
        <!-- Status Section -->
        <div class="section" id="statusSection">
            <h2>Command Status</h2>
            <div id="commandStatus" class="status-text">
                No commands sent yet
            </div>
        </div>
    </div>

    <script>
        let websocket = null;
        let isConnected = false;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateCommandForm();
            disableCommandSection();
        });
        
        function connect() {
            const ipAddress = document.getElementById('ipAddress').value.trim();
            const deviceId = document.getElementById('deviceId').value.trim();
            if (!ipAddress) {
                alert('Please enter an IP address');
                return;
            }
            if (!deviceId) {
                alert('Please enter a device ID');
                return;
            }
            
            const connectBtn = document.getElementById('connectBtn');
            const status = document.getElementById('status');
            
            // Update UI to connecting state
            connectBtn.disabled = true;
            connectBtn.textContent = 'Connecting...';
            status.textContent = 'Connecting...';
            status.className = 'status connecting';
            status.style.display = 'block';
            
            // Create WebSocket connection
            const wsUrl = `ws://${ipAddress}:7071/vexrobotics.vexcode/device?id=${deviceId}`;
            websocket = new WebSocket(wsUrl);
            
            websocket.onopen = function() {
                isConnected = true;
                status.textContent = 'Connected';
                status.className = 'status connected';
                connectBtn.textContent = 'Connected';
                connectBtn.disabled = true;
                enableCommandSection();
                
                // Hide the status display after a short delay
                setTimeout(() => {
                    status.style.display = 'none';
                }, 1000);
            };
            
            websocket.onclose = function() {
                isConnected = false;
                status.textContent = 'Disconnected';
                status.className = 'status disconnected';
                connectBtn.textContent = 'Connect';
                connectBtn.disabled = false;
                disableCommandSection();
            };
            
            websocket.onerror = function(error) {
                isConnected = false;
                status.textContent = 'Connection Failed';
                status.className = 'status disconnected';
                connectBtn.textContent = 'Connect';
                connectBtn.disabled = false;
                disableCommandSection();
                console.error('WebSocket error:', error);
            };
        }
        
        function disableCommandSection() {
            const commandSection = document.getElementById('commandSection');
            const statusSection = document.getElementById('statusSection');
            const sendBtn = document.getElementById('sendBtn');
            
            commandSection.classList.add('disabled');
            statusSection.classList.add('disabled');
            sendBtn.disabled = true;
            
            // Disable all inputs in command section
            const inputs = commandSection.querySelectorAll('input, select');
            inputs.forEach(input => input.disabled = true);
        }
        
        function enableCommandSection() {
            const commandSection = document.getElementById('commandSection');
            const statusSection = document.getElementById('statusSection');
            const sendBtn = document.getElementById('sendBtn');
            const connectionSection = document.querySelector('.section:first-of-type');
            
            // Hide connection section
            connectionSection.style.display = 'none';
            
            commandSection.classList.remove('disabled');
            statusSection.classList.remove('disabled');
            sendBtn.disabled = false;
            
            // Enable all inputs in command section
            const inputs = commandSection.querySelectorAll('input, select');
            inputs.forEach(input => input.disabled = false);
        }
        
        function updateCommandForm() {
            const commandType = document.getElementById('commandType').value;
            const commandParams = document.getElementById('commandParams');
            
            let html = '';
            
            switch (commandType) {
                case 'drive':
                    html = `
                        <div class="form-group">
                            <label for="distance">Distance (inches):</label>
                            <input type="number" id="distance" value="0" min="-100" max="100" step="1" inputmode="text">
                        </div>
                    `;
                    break;
                    
                case 'turn':
                    html = `
                        <div class="form-group">
                            <label for="heading">Heading (0-360°):</label>
                            <input type="number" id="heading" value="0" min="0" max="360" step="1" inputmode="numeric">
                        </div>
                    `;
                    break;
                    
                case 'set_heading':
                    html = `
                        <div class="form-group">
                            <label for="heading">Heading (0-360°):</label>
                            <input type="number" id="heading" value="0" min="0" max="360" step="1" inputmode="numeric">
                        </div>
                    `;
                    break;
            }
            
            commandParams.innerHTML = html;
            
            // Re-apply disabled state if not connected
            if (!isConnected) {
                disableCommandSection();
            }
        }
        
        function sendCommand() {
            if (!isConnected || !websocket) {
                alert('Not connected to robot');
                return;
            }
            
            const commandType = document.getElementById('commandType').value;
            let commandString = '';
            
            switch (commandType) {
                case 'drive':
                    const distance = document.getElementById('distance').value;
                    commandString = `drive ${distance}\n`;
                    break;
                    
                case 'turn':
                    const turnHeading = document.getElementById('heading').value;
                    commandString = `turn ${turnHeading}\n`;
                    break;
                    
                case 'set_heading':
                    const setHeading = document.getElementById('heading').value;
                    commandString = `set_heading ${setHeading}\n`;
                    break;
            }
            
            if (commandString) {
                websocket.send(commandString);
                console.log('Sent command:', commandString.trim());
                
                // Update command status
                const timestamp = new Date().toLocaleTimeString();
                const statusText = `[${timestamp}] Sent: ${commandString.trim()}`;
                document.getElementById('commandStatus').textContent = statusText;
            }
        }
    </script>
</body>
</html>
