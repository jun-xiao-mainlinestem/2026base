<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGB Remote Control</title>
    <style>
        body {
            margin: 0;
            padding: 16px;
            font-family: system-ui, -apple-system, sans-serif;
            line-height: 1.5;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .section {
            margin-bottom: 24px;
            padding: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        button {
            background: #007bff;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .disabled {
            opacity: 0.5;
        }
        
        .status-text {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        h2 {
            margin-top: 0;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Connection Section -->
        <div class="section" id="connectionSection">
            <h2>Connect to Robot</h2>
            <div class="form-group">
                <input type="text" id="deviceId" placeholder="Device ID" inputmode="numeric">
            </div>
            <button id="connectBtn" onclick="connect()">Connect</button>
        </div>
        
        <!-- Command Section -->
        <div class="section" id="commandSection">
            <h2>Select Command</h2>
            <div class="form-group">
                <label for="commandType">Command Type:</label>
                <select id="commandType" onchange="updateCommandForm()">
                    <option value="drive">Drive</option>
                    <option value="turn">Turn</option>
                    <option value="set_heading">Set Heading</option>
                </select>
            </div>
            
            <div id="commandParams">
                <!-- Command parameters will be inserted here -->
            </div>
            
            <button id="sendBtn" onclick="sendCommand()" disabled>Send Command</button>
        </div>
        
        <!-- Status Section -->
        <div class="section" id="statusSection">
            <h2>Command Status</h2>
            <div id="commandStatus" class="status-text">
                No commands sent yet
            </div>
        </div>
    </div>

    <script>
        let websocket = null;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateCommandForm();
            toggleCommandSection(false);
        });
        
        function connect() {
            const deviceId = document.getElementById('deviceId').value.trim();
            if (!deviceId) {
                alert('Please enter the device ID');
                return;
            }
            
            // Get IP address from current page URL
            const currentURL = window.location.href;
            const url = new URL(currentURL);
            const ipAddress = url.hostname;
            
            const connectBtn = document.getElementById('connectBtn');
            connectBtn.disabled = true;
            connectBtn.textContent = 'Connecting...';
            
            // Create WebSocket connection
            websocket = new WebSocket(`ws://${ipAddress}:7071/vexrobotics.vexcode/device?id=${deviceId}`);
            
            websocket.onopen = function() {
                connectBtn.textContent = 'Connected';
                connectBtn.disabled = true;
                document.getElementById('connectionSection').style.display = 'none';
                toggleCommandSection(true);
            };
            
            websocket.onclose = function() {
                connectBtn.textContent = 'Connect';
                connectBtn.disabled = false;
                toggleCommandSection(false);
            };
            
            websocket.onerror = function() {
                connectBtn.textContent = 'Connect';
                connectBtn.disabled = false;
                toggleCommandSection(false);
            };
        }
        
        function toggleCommandSection(enabled) {
            const commandSection = document.getElementById('commandSection');
            const statusSection = document.getElementById('statusSection');
            const sendBtn = document.getElementById('sendBtn');
            
            if (enabled) {
                commandSection.classList.remove('disabled');
                statusSection.classList.remove('disabled');
                sendBtn.disabled = false;
                commandSection.querySelectorAll('input, select').forEach(input => input.disabled = false);
            } else {
                commandSection.classList.add('disabled');
                statusSection.classList.add('disabled');
                sendBtn.disabled = true;
                commandSection.querySelectorAll('input, select').forEach(input => input.disabled = true);
            }
        }
        
        function updateCommandForm() {
            const commandType = document.getElementById('commandType').value;
            const commandParams = document.getElementById('commandParams');
            
            let html = '';
            if (commandType === 'drive') {
                html = `
                    <div class="form-group">
                        <label for="distance">Distance (inches):</label>
                        <input type="number" id="distance" value="0" min="-100" max="100" step="1" inputmode="text">
                    </div>
                `;
            } else {
                html = `
                    <div class="form-group">
                        <label for="heading">Heading (0-360Â°):</label>
                        <input type="number" id="heading" value="0" min="0" max="360" step="1" inputmode="numeric">
                    </div>
                `;
            }
            
            commandParams.innerHTML = html;
            
            // Re-apply disabled state if not connected
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                toggleCommandSection(false);
            }
        }
        
        function sendCommand() {
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                alert('Not connected to robot');
                return;
            }
            
            const commandType = document.getElementById('commandType').value;
            let commandString = '';
            
            if (commandType === 'drive') {
                const distance = document.getElementById('distance').value;
                commandString = `drive ${distance}\n`;
            } else {
                const heading = document.getElementById('heading').value;
                commandString = `${commandType} ${heading}\n`;
            }
            
            if (commandString) {
                websocket.send(commandString);
                const timestamp = new Date().toLocaleTimeString();
                document.getElementById('commandStatus').textContent = `[${timestamp}] Sent: ${commandString.trim()}`;
                
                // Reset distance input to 0 for drive command
                if (commandType === 'drive') {
                    const distanceInput = document.getElementById('distance');
                    if (distanceInput) {
                        distanceInput.value = '0';
                    }
                }
            }
        }
    </script>
</body>
</html>
